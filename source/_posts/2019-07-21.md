---
title: day189-MyVue-完善Observer
tags: 
- 前端
categories: 
- 技术
date: 2019-7-21
grammar_cjkRuby: true
---
## 要点

1. 从Vue.js中入手，先完善` new Obersver(this._data) `
 
<!--more-->
## Obersver

```js
/**
 * 观察者，需要观察到的实例属性,通过set、get把数据发布者订阅者绑定在一起
 */
import Dep from './Dep'

class Observer {
  constructor (data) {
    this.data = data
    Object.keys(this.data).forEach(key => {
      this._bind(data, key, data[key])
    })
  }
  _bind(data, key, val) {
    var myDep = new Dep()
    // 逐个改掉
    Object.defineProperty(data, key, {
      get () {
        if (Dep.target) myDep.listen(Dep.target)
        return val
      },
      set (newVal) {
        if (val === newVal) return
        val = newVal
        myDep.notify()
      }
    })
  }
  
}

export default Observer
```