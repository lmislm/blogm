---
title: day45-闭包的小例子
tags: 
- 前端
categories: 
- 技术
date:  2019-2-24
grammar_cjkRuby: true
---
### 封装变量
在平时运用中，闭包用的比较多的还是对于函数或者变量的封装。本文借鉴一个小例子，示范闭包的应用。


![](https://ws1.sinaimg.cn/large/b15ca614gy1g0htblls4wj207s09gwey.jpg)
<!--more-->
### 原函数
```javascript
let mult = function () {
  let a = 1
  for (let i = 0; i < arguments.length; i++) {
    a = a * arguments[i]
  }
  return a
}
console.log(mult(1, 2, 3)) // 6
```
### 封装变量
```javascript
let cache = {} // 注意是全局变量
let mult = function () {
  let args = Array.prototype.join.call(arguments, ',')
  if (cache[args]) {
    return cache[args]
  }
  console.log('==')
  let a = 1
  for (let i = 0; i < arguments.length; i++) {
    a = a * arguments[i]
  }
  return cache[args] = a
}
console.log(mult(1,2,3))
console.log(mult(1,2,3))
// ==
// 6
// 6
```
### 优化全局变量
+ 很错误的方法啊！
```javascript
let mult = function () {
  let cache = {}
  let args = Array.prototype.join.call(arguments, ',')
  if (cache[args]) {
    return cache[args]
  }
  console.log('==')
  let a = 1
  for (let i = 0; i < arguments.length; i++) {
    a = a * arguments[i]
  }
  return cache[args] = a
}
console.log(mult(1, 2, 3))
console.log(mult(1, 2, 3))
// ==
// 6
// 6
```
+ 正确方法之一
```javascript
let mult = (function () {
  let cache = {}
  return function () {
    let args = Array.prototype.join.call(arguments, ',')
    if (cache[args]) {
      return
    }
    let a = 1
    for (let i = 0; i < arguments.length; i++) {
      a = a * arguments[i]
    }
    return cache[args] = a
  }
})()
console.log(mult(1, 2 ,3))
console.log(mult(1, 2 ,3))
// ==
// 6
// 6
```
### 提炼函数
```javascript
let mult = (function () {
  let cache = {}
  let calculate = function () {
    let a = 1
    for (let i = 0; i < arguments.length; i++) {
      a = a * arguments[i]
    }
    return a
  }
  return function () {
    let args = Array.prototype.join.call(arguments, ',')
    if (args in cache) {
      return cache[args]
    }
    console.log('++')
    return cache[args] = calculate.apply(null, arguments)
  }
})()
console.log(mult(1, 2, 3))
// 6
```
以上就是我要说的话了，show code.
--end 
